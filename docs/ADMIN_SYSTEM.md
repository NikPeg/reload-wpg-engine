# üîê –°–∏—Å—Ç–µ–º–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è WPG Engine

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è WPG Engine –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≥–∏–±–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º –∫ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤.

## üéØ –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã

### 1. **–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∞–¥–º–∏–Ω–æ–≤**

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–≤–∞ —Å–ø–æ—Å–æ–±–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:

#### A. **–ê–¥–º–∏–Ω—ã –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è**
```bash
# –í —Ñ–∞–π–ª–µ .env
TG_ADMIN_IDS=123456789,987654321,555666777
```

#### B. **–ê–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞**
- –ü–µ—Ä–≤—ã–π –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–≥—Ä–æ–∫ –≤ –∏–≥—Ä–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
- –ï—Å–ª–∏ –≤ –∏–≥—Ä–µ –Ω–µ—Ç –∞–¥–º–∏–Ω–æ–≤, —Å–ª–µ–¥—É—é—â–∏–π –∏–≥—Ä–æ–∫ —Ç–∞–∫–∂–µ –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞

### 2. **–†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**

```python
class PlayerRole(str, Enum):
    ADMIN = "admin"      # –ü–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    PLAYER = "player"    # –û–±—ã—á–Ω—ã–π –∏–≥—Ä–æ–∫
    OBSERVER = "observer" # –ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ)
```

## üõ†Ô∏è –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. **–£—Ç–∏–ª–∏—Ç—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è** ([`wpg_engine/core/admin_utils.py`](wpg_engine/core/admin_utils.py))

#### `determine_player_role(telegram_id, game_id, db)`
–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–æ–ª—å –∏–≥—Ä–æ–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ:
1. –°–ø–∏—Å–∫–∞ –∞–¥–º–∏–Ω–æ–≤ –∏–∑ `.env`
2. –ê–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞
3. –ü—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∞–¥–º–∏–Ω–æ–≤ –≤ –∏–≥—Ä–µ

#### `is_admin(telegram_id, db)`
–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### 2. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** ([`wpg_engine/config/settings.py`](wpg_engine/config/settings.py))

```python
class TelegramSettings(BaseSettings):
    admin_ids_str: str = Field(default="", alias="TG_ADMIN_IDS")
    
    @property
    def admin_ids(self) -> list[int]:
        """–ü–∞—Ä—Å–∏–Ω–≥ –∞–¥–º–∏–Ω–æ–≤ –∏–∑ —Å—Ç—Ä–æ–∫–∏"""
        # –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç: "123,456,789"
```

### 3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π** ([`wpg_engine/adapters/telegram/handlers/registration.py`](wpg_engine/adapters/telegram/handlers/registration.py))

–ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞:
1. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ä–æ–ª—å —á–µ—Ä–µ–∑ `determine_player_role()`
2. –°–æ–∑–¥–∞–µ—Ç—Å—è –∏–≥—Ä–æ–∫ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Ä–æ–ª—å—é
3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤

### 4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –≤ –∫–æ–º–∞–Ω–¥–∞—Ö** ([`wpg_engine/adapters/telegram/handlers/admin.py`](wpg_engine/adapters/telegram/handlers/admin.py))

–í—Å–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç:
```python
if not await is_admin(user_id, game_engine.db):
    await message.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.")
    return
```

## üìã –ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/start` | –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∏ –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ |
| `/game_stats` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä—ã |
| `/update_game` | –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–≥—Ä—ã |
| `/restart_game` | –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–≥—Ä—É (–ø–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞) |
| `/event` | –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—Å–µ–º –∏–≥—Ä–æ–∫–∞–º |

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–æ–≤ —á–µ—Ä–µ–∑ .env**

```bash
# –û–¥–∏–Ω –∞–¥–º–∏–Ω
TG_ADMIN_IDS=123456789

# –ù–µ—Å–∫–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
TG_ADMIN_IDS=123456789,987654321,555666777

# –ü—É—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ)
TG_ADMIN_IDS=
```

### 2. **–ü–æ–ª—É—á–µ–Ω–∏–µ Telegram ID**

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–≤–æ–µ–≥–æ Telegram ID:
1. –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É `/start`
2. –í–∞—à ID –±—É–¥–µ—Ç –≤ –ª–æ–≥–∞—Ö –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ—Ç–∞ @userinfobot

### 3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã**

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
python test_admin_system.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
python test_settings.py
```

## üéÆ –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–æ–≤–∞—è –∏–≥—Ä–∞ –±–µ–∑ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∞–¥–º–∏–Ω–æ–≤
1. –ü–µ—Ä–≤—ã–π –∏–≥—Ä–æ–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è ‚Üí –ø–æ–ª—É—á–∞–µ—Ç —Ä–æ–ª—å `ADMIN`
2. –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∏–≥—Ä–æ–∫–∏ ‚Üí –ø–æ–ª—É—á–∞—é—Ç —Ä–æ–ª—å `PLAYER`

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ò–≥—Ä–∞ —Å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –∞–¥–º–∏–Ω–∞–º–∏
1. –ò–≥—Ä–æ–∫–∏ –∏–∑ `TG_ADMIN_IDS` ‚Üí –ø–æ–ª—É—á–∞—é—Ç —Ä–æ–ª—å `ADMIN`
2. –û—Å—Ç–∞–ª—å–Ω—ã–µ –∏–≥—Ä–æ–∫–∏ ‚Üí –ø–æ–ª—É—á–∞—é—Ç —Ä–æ–ª—å `PLAYER`

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –°–º–µ—à–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
1. –ê–¥–º–∏–Ω—ã –∏–∑ `.env` ‚Üí `ADMIN`
2. –ï—Å–ª–∏ –∞–¥–º–∏–Ω–æ–≤ –Ω–µ—Ç, –ø–µ—Ä–≤—ã–π –∏–≥—Ä–æ–∫ ‚Üí `ADMIN`
3. –û—Å—Ç–∞–ª—å–Ω—ã–µ ‚Üí `PLAYER`

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –í—Å–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã –∑–∞—â–∏—â–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–∞–≤
- ‚úÖ –†–æ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∞–¥–º–∏–Ω–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∞–¥–º–∏–Ω–æ–≤
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è Telegram ID

## üöÄ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ä–æ–ª–µ–π:

1. –û–±–Ω–æ–≤–∏—Ç—å `PlayerRole` enum
2. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –≤ `determine_player_role()`
3. –°–æ–∑–¥–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤
4. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

## üìù –ü—Ä–∏–º–µ—Ä—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –≤ –Ω–æ–≤–æ–π –∫–æ–º–∞–Ω–¥–µ
```python
async def my_admin_command(message: Message, game_engine: GameEngine):
    if not await is_admin(message.from_user.id, game_engine.db):
        await message.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.")
        return
    
    # –õ–æ–≥–∏–∫–∞ –∞–¥–º–∏–Ω—Å–∫–æ–π –∫–æ–º–∞–Ω–¥—ã
    await message.answer("‚úÖ –ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞!")
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–æ–ª–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
```python
role = await determine_player_role(
    telegram_id=user_id,
    game_id=game_id,
    db=session
)

if role == PlayerRole.ADMIN:
    await message.answer("üëë –í—ã –Ω–∞–∑–Ω–∞—á–µ–Ω—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º!")